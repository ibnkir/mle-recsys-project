# Яндекс Практикум, курс "Инженер Машинного Обучения" (2024 г.)
# Проект 4-го спринта: "Создание рекомендательной системы"
# Выполнил: Кирилл Н., email: ibnkir@yandex.ru, tg: [Xmg23](https://t.me/Xmg23)

## Описание проекта
Целью проекта является создание системы рекомендаций треков 
пользователям музыкального сервиса на основе их вкусов и предпочтений.
В рамках проекта был разработан пайплайн для расчета нескольких типов рекомендаций,
который был интегрирован в веб-сервис на базе FastAPI.

Основные инструменты и Python-библиотеки:
- Visual Studio Code,
- FastAPI, 
- uvicorn,
- Jupyter Lab,
- implicit.ALS


## Как воспользоваться репозиторием
1. Перейдите в домашнюю папку и склонируйте репозиторий на ваш компьютер
   ```bash
   cd ~
   git clone https://github.com/ibnkir/mle-recsys-project
   ```

2. Создайте виртуальное окружение и установите в него необходимые Python-пакеты
    ```
    python3 -m venv env_recsys_start
    . env_recsys_start/bin/activate
    pip install -r requirements.txt
    ```

3. Скачайте три файла с исходными данными в папку репозитория
    - Данные о треках - [tracks.parquet](https://storage.yandexcloud.net/mle-data/ym/tracks.parquet)
    - Имена артистов, названия альбомов, треков и жанров - [catalog_names.parquet](https://storage.yandexcloud.net/mle-data/ym/catalog_names.parquet)
    - Данные о том, какие пользователи прослушали тот или иной трек - [interactions.parquet](https://storage.yandexcloud.net/mle-data/ym/interactions.parquet)
 
    Для удобства можно воспользоваться командой wget:
    ```
    wget https://storage.yandexcloud.net/mle-data/ym/tracks.parquet
    wget https://storage.yandexcloud.net/mle-data/ym/catalog_names.parquet
    wget https://storage.yandexcloud.net/mle-data/ym/interactions.parquet
    ```

4. Запустите Jupyter Lab в командной строке
    ```
    jupyter lab --ip=0.0.0.0 --no-browser
    ```

5. Чтобы не выполнять подготовительный код в Jupyter-ноутбуках, можно скачать готовые файлы с рекомендациями
    - Финальные рекомендации [recommendations.parquet](https://disk.yandex.ru/d/R1ULEtxD49lwCQ)
    - Топ-треки [top_popular.parquet](https://disk.yandex.ru/d/r77Dj16hUuB6CA)
    - Похожие треки [similar.parquet](https://disk.yandex.ru/d/uOb0ISU6lbDF8g)

## Этапы и результаты выполнения проекта
1. __Предобработка данных и EDA__
    - Проверили исходные данные на наличие пропусков, дубликатов, некорректных типов, 
    значений и связей между таблицами. Обнаруженные ошибки были исправлены;
    - Для экономии ресурсов в истории взаимодействий были оставлены только самые
    активные пользователи с количеством прослушанных за год треков от 1000;
    - Предобработанные данные о треках и взаимодействиях сохранены в файлах 
    `items.parquet` и `events.parquet`.
    
    Код для предварительной обработки и EDA находится в файле `part_1_preprocess_eda.ipynb`.

2. __Расчёт рекомендаций__
    
    Использованы следующие подходы для генерации рекомендаций:
    - Рекомендации по умолчанию на основе топ-треков по количеству прослушиваний,
    - Персональные рекомендации на основе коллаборативного подхода и ALS:
        - 
    - Персональные рекомендации на основе контентного подхода, ALS и информации о жанрах:
    - Рекомендации на основе похожих треков на основе ALS:


    Код для расчёта рекомендаций находится в файле `part_2_recs.ipynb`.

3. __Запуск и тестирования сервиса__
    
    Исходный код основного и вспомогательных сервисов содержится в следующих файлах:
    - `recommendations_service.py` - основной сервис для генерации оффлайн- и онлайн-рекомендаций;
    - `features_service.py` - вспомогательный сервис для поиска похожих треков;
    - `events_service.py` - вспомогательный сервис сохранения и получения 
    последних прослушанных треков пользователя.
    
    Для запуска сервисов необходимо выполнить 3 команды в 3-х разных терминалах, находясь в папке проекта:
    ```
    uvicorn recommendations_service:app
    uvicorn events_service:app --port 8020
    uvicorn features_service:app --port 8010
    ```
    
    Для тестирования сервисов необходимо выполнить код в соответствующих ячейках Jupyter-ноутбука `part_3_test.ipynb`. В нем представлены три тестовых сценария:
    - Получение рекомендаций по умолчанию;
    - Получение персональных рекомендаций без онлайн-истории;
    - Получение персональных рекомендаций с онлайн-историей.

